# Service Proxy

Service Proxy - это компонент, который перенаправляет запросы к внутренним микросервисам. Для каждого внутреннего сервиса создается свой экземпляр Service Proxy.

## Принцип работы

1. Создается на основе URL внутреннего сервиса
2. Использует `httputil.ReverseProxy` для перенаправления запросов
3. Модифицирует заголовки запроса для корректной маршрутизации
4. Передает информацию о пользователе во внутренний сервис

## Методы

### ProxyRequest

Основной метод, который выполняет перенаправление запроса:

1. Парсит URL целевого сервиса
2. Устанавливает схему и хост запроса
3. Добавляет заголовок `X-Forwarded-Host`
4. Передает запрос целевому сервису через `httputil.ReverseProxy`

### WithAuth

Метод добавляет информацию о пользователе в заголовки запроса:

1. Извлекает информацию о пользователе из контекста запроса
2. Добавляет заголовок `X-User-ID` с идентификатором пользователя

## Конфигурация сервисов

Сервисы конфигурируются в файле `config/services.json`. Для каждого сервиса указывается:
- `name` - имя сервиса, которое используется для формирования маршрутов
- `url` - URL внутреннего сервиса

Например, для сервиса с именем "employee" будут созданы маршруты:
- `/api/employees` - для работы с коллекцией сотрудников
- `/api/employees/{id}` - для работы с конкретным сотрудником

## Добавление новых сервисов

Для добавления нового сервиса необходимо:

1. Добавить запись в `config/services.json`:
```json
{
  "name": "new-service",
  "url": "http://new-service:8080"
}
```

2. После перезапуска API Gateway автоматически создаст маршрут `/api/new-services` для перенаправления запросов к новому сервису.